<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mosport V6 | Find Your Game (Debug Mode)</title>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mosport: {
                            black: '#000000',
                            dark: '#0A0A0A',
                            card: '#121212',
                            fan: '#2E5296',
                            venue: '#D62470',
                            staff: '#FFFFFF',
                            success: '#10B981',
                            warning: '#F59E0B',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        fadeIn: 'fadeIn 0.5s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #000000;
            color: white;
        }

        /* Custom scrollbar for dark mode */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // TYPES
        // ==========================================
        const UserRole = {
            FAN: 'FAN',
            VENUE: 'VENUE',
            STAFF: 'STAFF'
        };

        const QoETagType = {
            SURVIVAL: 'SURVIVAL',
            BROADCAST: 'BROADCAST',
            VIBE: 'VIBE'
        };

        // ==========================================
        // CONSTANTS
        // ==========================================
        const APP_NAME = "MOSPORT";
        const APP_VERSION = "V7.0 Beta (Standalone)";
        const FALLBACK_VENUE_IMAGE = "https://images.unsplash.com/photo-1518176258769-f227c798150e?auto=format&fit=crop&w=400&q=80";

        const generateBacNinhVenues = () => {
            const names = [
                "Bac Ninh Sports Zone", "Kinh Bac Arena", "Tu Son Goal Bar", "V-Pub Bac Ninh", "The 99 Club",
                "Bac Ninh Victory", "Red River Taproom", "Lim Stadium Cafe", "Dabaco Sports Lounge", "Phoenix Bar",
                "Bac Ninh Corner", "Green Field Pub", "Scoreboard BN", "Halftime Bac Ninh", "Penalty Spot BN",
                "Ultra Fan Zone", "Bac Ninh Brew", "Goal Line Cafe", "Striker's Den", "Defender's Pub",
                "Midfield Lounge", "Winger's Bar", "Keeper's Castle", "The Whistle Stop", "Extra Time BN",
                "Shootout Lounge", "Trophy Room BN", "Champions Corner", "League Leader", "Relegation Battle Bar"
            ];

            return names.map((name, idx) => ({
                id: `bn${idx}`,
                name: name,
                location: 'Bac Ninh',
                distance: `${(Math.random() * 10 + 20).toFixed(1)} km`,
                rating: 4.0 + (Math.random() * 0.9),
                imageUrl: `https://images.unsplash.com/photo-${1510000000000 + idx}?auto=format&fit=crop&w=400&q=80`,
                lastVerified: new Date(),
                googleMapUrl: 'https://maps.google.com/?q=Bac+Ninh',
                tags: [
                    { id: `tbn${idx}`, type: QoETagType.BROADCAST, label: 'Live Match', confidence: 0.95 }
                ]
            }));
        };

        const MOCK_VENUES = [
            {
                id: 'v1',
                name: 'Puku Cafe & Bar',
                location: 'Ha Noi',
                distance: '0.5 km',
                rating: 4.5,
                imageUrl: 'https://images.unsplash.com/photo-1554118811-1e0d58224f24?auto=format&fit=crop&w=400&q=80',
                lastVerified: new Date(),
                googleMapUrl: 'https://maps.app.goo.gl/Zykrr4jQGyEvPuNS8',
                tags: [
                    { id: 't1', type: QoETagType.BROADCAST, label: 'Big Screen', confidence: 0.98 },
                    { id: 't2', type: QoETagType.VIBE, label: 'Sound ON', confidence: 0.95 }
                ]
            },
            {
                id: 'v2',
                name: 'The Republic',
                location: 'Ha Noi',
                distance: '3.2 km',
                rating: 4.6,
                imageUrl: 'https://images.unsplash.com/photo-1514933651103-005eec06c04b?auto=format&fit=crop&w=400&q=80',
                lastVerified: new Date(),
                tags: [
                    { id: 't3', type: QoETagType.BROADCAST, label: 'Multi-Screen', confidence: 0.92 },
                    { id: 't4', type: QoETagType.VIBE, label: 'Rowdy', confidence: 0.85 }
                ]
            },
            {
                id: 'v3',
                name: 'SportivO',
                location: 'Ha Noi',
                distance: '0.8 km',
                rating: 4.4,
                imageUrl: 'https://images.unsplash.com/photo-1574602305307-b3b3a602319e?auto=format&fit=crop&w=400&q=80',
                lastVerified: new Date(Date.now() - 86400000),
                tags: [
                    { id: 't5', type: QoETagType.SURVIVAL, label: 'Open Late', confidence: 0.99 }
                ]
            },
            {
                id: 'v4',
                name: 'BOOM Bar',
                location: 'Ha Noi',
                distance: '1.1 km',
                rating: 4.2,
                imageUrl: 'https://images.unsplash.com/photo-1566417713940-fe7c737a9ef2?auto=format&fit=crop&w=400&q=80',
                lastVerified: new Date(Date.now() - 3600000),
                tags: []
            },
            {
                id: 'v5',
                name: "O'Learys Sports Bar",
                location: 'Ha Noi',
                distance: '2.5 km',
                rating: 4.7,
                imageUrl: 'https://images.unsplash.com/photo-1575444758702-4a6b9222336e?auto=format&fit=crop&w=400&q=80',
                lastVerified: new Date(),
                tags: [
                    { id: 't6', type: QoETagType.BROADCAST, label: 'Giant LED', confidence: 0.99 },
                    { id: 't7', type: QoETagType.VIBE, label: 'Premium', confidence: 0.90 }
                ]
            },
            {
                id: 'v6',
                name: 'The Moose & Roo',
                location: 'Ha Noi',
                distance: '1.5 km',
                rating: 4.3,
                imageUrl: 'https://images.unsplash.com/photo-1559339352-11d035aa65de?auto=format&fit=crop&w=400&q=80',
                lastVerified: new Date(Date.now() - 7200000),
                tags: [
                    { id: 't8', type: QoETagType.VIBE, label: 'Chill', confidence: 0.88 },
                    { id: 't9', type: QoETagType.SURVIVAL, label: 'Great Food', confidence: 0.95 }
                ]
            },
            {
                id: 'v7',
                name: 'Pasteur Street Brewing',
                location: 'Ha Noi',
                distance: '0.3 km',
                rating: 4.8,
                imageUrl: 'https://images.unsplash.com/photo-1584225064785-c62a8b43d148?auto=format&fit=crop&w=400&q=80',
                lastVerified: new Date(),
                tags: [
                    { id: 't10', type: QoETagType.VIBE, label: 'Craft Beer', confidence: 0.97 },
                    { id: 't11', type: QoETagType.BROADCAST, label: 'Projector', confidence: 0.85 }
                ]
            },
            {
                id: 'v8',
                name: '7 Bridges Brewing',
                location: 'Ha Noi',
                distance: '4.0 km',
                rating: 4.5,
                imageUrl: 'https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?auto=format&fit=crop&w=400&q=80',
                lastVerified: new Date(Date.now() - 12000000),
                tags: [
                    { id: 't12', type: QoETagType.VIBE, label: 'Rooftop', confidence: 0.94 }
                ]
            },
            ...generateBacNinhVenues()
        ];

        const MOCK_EVENTS = [
            {
                id: 'e1',
                title: 'Vietnam vs Thailand',
                league: 'AFF Cup',
                startTime: new Date(new Date().setHours(19, 30, 0, 0)),
                teamA: 'Vietnam',
                teamB: 'Thailand',
                isHot: true
            },
            {
                id: 'e2',
                title: 'Hanoi FC vs CAHN',
                league: 'V.League 1',
                startTime: new Date(new Date().setHours(19, 15, 0, 0)),
                teamA: 'Hanoi FC',
                teamB: 'CAHN',
                isHot: true
            },
            {
                id: 'e3',
                title: 'Man City vs Real Madrid',
                league: 'Champions League',
                startTime: new Date(new Date().setHours(2, 0, 0, 0)),
                teamA: 'Man City',
                teamB: 'Real Madrid',
                isHot: true
            },
            {
                id: 'e4',
                title: 'Nam Dinh vs Hai Phong',
                league: 'V.League 1',
                startTime: new Date(new Date().setHours(18, 0, 0, 0)),
                teamA: 'Nam Dinh',
                teamB: 'Hai Phong',
                isHot: false
            },
            {
                id: 'e5',
                title: 'Man Utd vs Liverpool',
                league: 'Premier League',
                startTime: new Date(new Date().setHours(22, 30, 0, 0)),
                teamA: 'Man Utd',
                teamB: 'Liverpool',
                isHot: true
            }
        ];

        const ROLE_THEMES = {
            [UserRole.FAN]: {
                primary: 'text-mosport-fan',
                bg: 'bg-mosport-fan',
                border: 'border-mosport-fan',
                hover: 'hover:bg-blue-800'
            },
            [UserRole.VENUE]: {
                primary: 'text-mosport-venue',
                bg: 'bg-mosport-venue',
                border: 'border-mosport-venue',
                hover: 'hover:bg-pink-800'
            },
            [UserRole.STAFF]: {
                primary: 'text-mosport-staff',
                bg: 'bg-mosport-staff',
                border: 'border-white',
                hover: 'hover:bg-gray-200'
            }
        };

        const VLEAGUE_TEAM_LINKS = {
            'Hanoi FC': 'https://www.facebook.com/officialhanoifc/?locale=vi_VN',
            'HNFC': 'https://www.facebook.com/officialhanoifc/?locale=vi_VN',
            'CAHN': 'https://www.facebook.com/CAHNFCVN/',
            'Cong An Ha Noi FC': 'https://www.facebook.com/CAHNFCVN/',
            'The Cong - Viettel': 'https://www.facebook.com/thecongviettelfc/?locale=vi_VN',
            'Viettel': 'https://www.facebook.com/thecongviettelfc/?locale=vi_VN',
            'Hai Phong': 'https://www.facebook.com/haiphongfootballclub',
            'Hai Phong FC': 'https://www.facebook.com/haiphongfootballclub',
            'Nam Dinh': 'https://www.facebook.com/ThepXanhNamDinhFC/',
            'Thep Xanh Nam Dinh': 'https://www.facebook.com/ThepXanhNamDinhFC/',
            'Dong A Thanh Hoa': 'https://www.facebook.com/DongAThanhHoaFootballClub',
            'Thanh Hoa': 'https://www.facebook.com/DongAThanhHoaFootballClub',
            'LPBank HAGL': 'https://www.facebook.com/haglfc.clb',
            'HAGL': 'https://www.facebook.com/haglfc.clb',
            'Song Lam Nghe An': 'https://www.facebook.com/SLNAFC',
            'SLNA': 'https://www.facebook.com/SLNAFC',
            'Becamex Binh Duong': 'https://www.facebook.com/becamextphochiminhfc',
            'Binh Duong': 'https://www.facebook.com/becamextphochiminhfc',
            'Ho Chi Minh City FC': 'https://www.facebook.com/hcmcfootballclub/?locale=vi_VN',
            'HCMC': 'https://www.facebook.com/hcmcfootballclub/?locale=vi_VN',
            'TP. HCM': 'https://www.facebook.com/hcmcfootballclub/?locale=vi_VN',
            'SHB Da Nang': 'https://www.facebook.com/shbdanang.official/',
            'Da Nang': 'https://www.facebook.com/shbdanang.official/',
            'Hong Linh Ha Tinh': 'https://www.facebook.com/HongLinhHaTinhOfficial/',
            'Ha Tinh': 'https://www.facebook.com/HongLinhHaTinhOfficial/',
            'Quang Nam FC': 'https://www.facebook.com/quangnamfc1997/?locale=vi_VN',
            'Quang Nam': 'https://www.facebook.com/quangnamfc1997/?locale=vi_VN',
        };

        // ==========================================
        // SERVICES (MoEngine)
        // ==========================================
        const calculateMatchProbability = (event, venue) => {
            let score = 0.5;
            const hoursSinceVerify = (Date.now() - venue.lastVerified.getTime()) / (1000 * 60 * 60);

            if (hoursSinceVerify < 2) score += 0.3;
            else if (hoursSinceVerify < 24) score += 0.1;
            else score -= 0.1;

            const hasBigScreen = venue.tags.some(t => t.type === QoETagType.BROADCAST);
            const hasVibe = venue.tags.some(t => t.type === QoETagType.VIBE);

            if (hasBigScreen) score += 0.15;
            if (hasVibe) score += 0.05;

            const varianceString = event.id + venue.id;
            const varianceScore = (varianceString.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) % 20) / 100;
            score += varianceScore;

            return Math.min(Math.max(score, 0), 1);
        };

        const determineVerificationStatus = (prob) => {
            if (prob >= 0.85) return 'VERIFIED';
            if (prob >= 0.6) return 'ON_REQUEST';
            return 'UNVERIFIED';
        };

        const getDecisionSignals = async (locationFilter) => {
            await new Promise(resolve => setTimeout(resolve, 600));
            const venueUsageCounter = {};

            const filteredVenues = locationFilter && locationFilter !== 'Near Current Loc'
                ? MOCK_VENUES.filter(v => v.location === locationFilter)
                : MOCK_VENUES;

            const signals = MOCK_EVENTS.map(event => {
                const matches = filteredVenues.map(venue => {
                    let prob = calculateMatchProbability(event, venue);
                    const usagePenalty = (venueUsageCounter[venue.id] || 0) * 0.15;
                    prob = Math.max(0, prob - usagePenalty);

                    return {
                        venue,
                        matchProbability: prob,
                        verificationStatus: determineVerificationStatus(prob)
                    };
                }).sort((a, b) => b.matchProbability - a.matchProbability);

                matches.slice(0, 3).forEach(match => {
                    venueUsageCounter[match.venue.id] = (venueUsageCounter[match.venue.id] || 0) + 1;
                });

                return {
                    eventId: event.id,
                    event,
                    matchedVenues: matches
                };
            });

            return signals;
        };

        // ==========================================
        // COMPONENTS
        // ==========================================

        // Button
        const Button = ({ children, variant = 'primary', fullWidth = false, className = '', ...props }) => {
            const baseStyles = "px-4 py-2 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2";
            const widthStyle = fullWidth ? "w-full" : "";
            let variantStyle = "";

            switch (variant) {
                case 'primary': variantStyle = "bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-900/20"; break;
                case 'secondary': variantStyle = "bg-pink-600 hover:bg-pink-700 text-white shadow-lg shadow-pink-900/20"; break;
                case 'outline': variantStyle = "border border-gray-600 text-gray-300 hover:border-white hover:text-white"; break;
                case 'ghost': variantStyle = "text-gray-400 hover:text-white"; break;
                case 'social': variantStyle = "bg-gray-800 hover:bg-gray-700 text-white border border-gray-700"; break;
            }

            return (
                <button className={`${baseStyles} ${widthStyle} ${variantStyle} ${className}`} {...props}>
                    {children}
                </button>
            );
        };

        // Navbar
        const Navbar = ({ currentRole, setRole, onLoginClick, onHomeClick }) => {
            const theme = ROLE_THEMES[currentRole];
            return (
                <nav className="sticky top-0 z-50 bg-mosport-black/90 backdrop-blur-md border-b border-gray-800">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center gap-3 cursor-pointer hover:opacity-80 transition-opacity" onClick={onHomeClick}>
                                <div className="text-2xl font-black tracking-tighter italic">
                                    <span className="text-mosport-fan">M</span>
                                    <span className="text-mosport-venue">S</span>
                                </div>
                                <span className="text-white font-bold tracking-wide hidden sm:block">MOSPORT</span>
                            </div>
                            <div></div>
                            <div className="flex items-center gap-4">
                                <button
                                    onClick={onLoginClick}
                                    className="hidden sm:flex text-right flex-col justify-center hover:opacity-80 transition-opacity cursor-pointer focus:outline-none"
                                >
                                    <span className={`text-[10px] uppercase font-bold ${theme.primary} tracking-widest`}>
                                        {currentRole} MODE
                                    </span>
                                </button>
                                <button onClick={onLoginClick} className="text-gray-300 hover:text-white transition-colors focus:outline-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </nav>
            );
        };

        // SearchHero (Updated Date Picker with Range)
        const SearchHero = ({ onSearch, onLocationChange, dateRange, onDateChange }) => {
            const [term, setTerm] = useState('');
            const fromDateRef = useRef(null);
            const toDateRef = useRef(null);

            const handleInputChange = (e) => {
                const val = e.target.value;
                setTerm(val);
                onSearch(val);
            };

            const triggerPicker = (ref) => {
                if (ref.current) {
                    try {
                        ref.current.showPicker();
                    } catch (e) {
                        // Fallback for older browsers: rely on the transparent input overlay
                        console.log('showPicker not supported', e);
                    }
                }
            };

            return (
                <div className="relative border-b border-gray-800 bg-mosport-card/50">
                    <div className="absolute inset-0 bg-gradient-to-b from-blue-900/10 to-transparent pointer-events-none" />
                    <div className="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8 relative z-10">
                        <h1 className="text-2xl sm:text-3xl font-bold text-center mb-6 text-white tracking-tight">
                            Find Your Game, <span className="text-gray-500">Anywhere.</span>
                        </h1>
                        <div className="max-w-4xl mx-auto bg-mosport-dark border border-gray-700 rounded-xl p-2 flex flex-col md:flex-row gap-2 shadow-2xl">
                            <div className="flex-[1.5] px-4 py-2 border-b md:border-b-0 md:border-r border-gray-700">
                                <label className="block text-[10px] text-gray-500 font-bold uppercase tracking-wider">I want to watch</label>
                                <input
                                    type="text"
                                    value={term}
                                    onChange={handleInputChange}
                                    placeholder="Team or League?"
                                    className="w-full bg-transparent text-white font-medium focus:outline-none placeholder-gray-600"
                                />
                            </div>
                            <div className="flex-[1.8] px-4 py-2 border-b md:border-b-0 md:border-r border-gray-700">
                                <label className="block text-[10px] text-gray-500 font-bold uppercase tracking-wider">Date Range (From - To)</label>
                                <div className="flex items-center gap-2">
                                    <span className="text-blue-500">üìÖ</span>

                                    {/* From Date */}
                                    <div
                                        className="relative flex items-center cursor-pointer min-w-[80px]"
                                        onClick={() => triggerPicker(fromDateRef)}
                                    >
                                        <div className={`text-xs font-medium ${dateRange.from ? 'text-white' : 'text-gray-500'} pointer-events-none`}>
                                            {dateRange.from ? new Date(dateRange.from).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : 'Start Date'}
                                        </div>
                                        <input
                                            ref={fromDateRef}
                                            type="date"
                                            lang="en"
                                            value={dateRange.from}
                                            onChange={(e) => onDateChange({ ...dateRange, from: e.target.value })}
                                            className="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer"
                                        />
                                    </div>

                                    <span className="text-gray-500">-</span>

                                    {/* To Date */}
                                    <div
                                        className="relative flex items-center cursor-pointer min-w-[80px]"
                                        onClick={() => triggerPicker(toDateRef)}
                                    >
                                        <div className={`text-xs font-medium ${dateRange.to ? 'text-white' : 'text-gray-500'} pointer-events-none`}>
                                            {dateRange.to ? new Date(dateRange.to).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : 'End Date'}
                                        </div>
                                        <input
                                            ref={toDateRef}
                                            type="date"
                                            lang="en"
                                            value={dateRange.to}
                                            onChange={(e) => onDateChange({ ...dateRange, to: e.target.value })}
                                            className="absolute inset-0 w-full h-full opacity-0 z-10 cursor-pointer"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div className="flex-1 px-4 py-2 border-b md:border-b-0 md:border-r border-gray-700">
                                <label className="block text-[10px] text-gray-500 font-bold uppercase tracking-wider">Location</label>
                                <div className="flex items-center gap-2">
                                    <span className="text-orange-500">üìç</span>
                                    <select
                                        onChange={(e) => onLocationChange(e.target.value)}
                                        className="bg-transparent text-white font-medium focus:outline-none w-full"
                                    >
                                        <option value="Ha Noi">Ha Noi</option>
                                        <option value="Bac Ninh">Bac Ninh</option>
                                    </select>
                                </div>
                            </div>
                            <div className="p-1">
                                <Button className="w-full md:w-auto h-full aspect-square" variant="primary">GO</Button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // DecisionCard
        const DecisionCard = ({ signal, userRole }) => {
            const isVenueRole = userRole === UserRole.VENUE;

            const handleBookTable = (e, venue) => {
                e.stopPropagation();
                if (venue.googleMapUrl) {
                    window.open(venue.googleMapUrl, '_blank');
                    return;
                }
                const query = encodeURIComponent(`${venue.name} ${venue.location}`);
                window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
            };

            const handleBuyTicket = (e) => {
                e.stopPropagation();
                const { league, title, teamA } = signal.event;
                let url = '';
                if (league.includes('V.League')) {
                    const homeTeamUrl = VLEAGUE_TEAM_LINKS[teamA];
                    url = homeTeamUrl || 'https://www.facebook.com/VPFProfessionalFootball';
                } else {
                    url = `https://www.google.com/search?q=${encodeURIComponent(title + ' official tickets')}`;
                }
                window.open(url, '_blank');
            };

            const formatDate = (date) => {
                return new Intl.DateTimeFormat('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                }).format(date);
            };

            return (
                <div className="bg-mosport-card rounded-xl border border-gray-800 overflow-hidden mb-6 transition-all hover:border-gray-700">
                    <div className="p-4 sm:p-6 flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between bg-gradient-to-r from-gray-900 to-mosport-card">
                        <div className="flex gap-4">
                            <div>
                                <div className="flex items-center gap-2 mb-1">
                                    <span className="text-[10px] font-bold text-gray-400 uppercase tracking-wider bg-gray-800 px-2 py-0.5 rounded">
                                        {signal.event.league}
                                    </span>
                                    <span className="text-[10px] font-bold text-blue-400 uppercase tracking-wider bg-blue-900/20 px-2 py-0.5 rounded border border-blue-900/30 flex items-center gap-1 ml-2">
                                        <span>üìÖ</span> {formatDate(signal.event.startTime)}
                                    </span>
                                    {signal.event.isHot && (
                                        <span className="flex items-center text-[10px] font-bold text-yellow-500 uppercase tracking-wider gap-1 animate-pulse ml-2">
                                            ‚òÖ Big Game
                                        </span>
                                    )}
                                </div>
                                <h3 className="text-lg font-bold text-white">
                                    <span className={signal.event.isHot ? 'text-blue-200' : ''}>{signal.event.teamA}</span>
                                    <span className="text-gray-500 mx-2">vs</span>
                                    <span className={signal.event.isHot ? 'text-blue-200' : ''}>{signal.event.teamB}</span>
                                </h3>
                            </div>
                        </div>
                        <Button variant="outline" className="text-xs h-8 px-3 border-gray-600 hover:border-yellow-500 hover:text-yellow-500" onClick={handleBuyTicket}>
                            Buy Ticket
                        </Button>
                    </div>
                    <div className="border-t border-gray-800">
                        <div className="px-4 py-2 bg-gray-900/50 flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <span className="text-[10px] font-bold text-gray-500 uppercase">
                                    {signal.matchedVenues.length} Verified Spots
                                </span>
                            </div>
                            {isVenueRole && <span className="text-[10px] font-bold text-mosport-venue">VENUE MODE: SHOWING RANKING</span>}
                        </div>
                        <div className="divide-y divide-gray-800">
                            {signal.matchedVenues.slice(0, 6).map((match, idx) => (
                                <div key={match.venue.id} className="p-4 flex gap-4 hover:bg-white/5 transition-colors group cursor-pointer">
                                    <div className="relative w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden flex-shrink-0 bg-gray-800">
                                        <img
                                            src={match.venue.imageUrl}
                                            alt={match.venue.name}
                                            className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"
                                            onError={(e) => { e.currentTarget.src = FALLBACK_VENUE_IMAGE; }}
                                        />
                                    </div>
                                    <div className="flex-1">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h4 className="font-bold text-white group-hover:text-blue-400 transition-colors">
                                                    {match.venue.name}
                                                    <span className="ml-2 text-xs font-normal text-gray-500">@{match.venue.location}</span>
                                                </h4>
                                                <div className="flex items-center gap-2 mt-1">
                                                    {match.verificationStatus === 'VERIFIED' && (
                                                        <span className="inline-flex items-center gap-1 text-[10px] font-bold text-mosport-success bg-mosport-success/10 px-1.5 py-0.5 rounded border border-mosport-success/20">
                                                            VERIFIED
                                                        </span>
                                                    )}
                                                    <div className="flex gap-1 ml-2">
                                                        {match.venue.tags.map(tag => (
                                                            <span key={tag.id} className="text-[9px] px-1 rounded border border-gray-700 text-gray-400">
                                                                {tag.label}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <div className="flex items-center justify-end gap-1 text-yellow-500 text-xs font-bold">
                                                    <span>‚òÖ</span><span>{match.venue.rating.toFixed(1)}</span>
                                                </div>
                                                {isVenueRole ? (
                                                    <div className="mt-2 text-mosport-venue font-mono text-xs">
                                                        Prob: {(match.matchProbability * 100).toFixed(0)}%
                                                    </div>
                                                ) : (
                                                    <Button variant="primary" className="mt-2 text-xs py-1 px-3 h-8" onClick={(e) => handleBookTable(e, match.venue)}>
                                                        Book Table
                                                    </Button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // VenueAnalytics (Unchanged)
        const VenueAnalytics = () => {
            return (
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 animate-fadeIn">
                    <div className="bg-gray-900 border border-gray-800 p-5 rounded-xl shadow-lg relative overflow-hidden group">
                        <div className="flex justify-between items-start mb-2">
                            <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest">Live Audience</h3>
                            <span className="flex h-2 w-2 relative">
                                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-mosport-venue opacity-75"></span>
                                <span className="relative inline-flex rounded-full h-2 w-2 bg-mosport-venue"></span>
                            </span>
                        </div>
                        <div className="flex items-baseline gap-2">
                            <span className="text-3xl font-black text-white">124</span>
                            <span className="text-xs font-medium text-green-500 flex items-center">+12%</span>
                        </div>
                    </div>
                    <div className="bg-gray-900 border border-gray-800 p-5 rounded-xl shadow-lg relative group">
                        <div className="flex justify-between items-start mb-2">
                            <h3 className="text-xs font-bold text-gray-500 uppercase tracking-widest">Signal Strength</h3>
                            <span className="text-[10px] font-mono text-mosport-venue bg-mosport-venue/10 px-2 py-0.5 rounded border border-mosport-venue/20">OPTIMAL</span>
                        </div>
                        <div className="flex items-center gap-4 mt-3">
                            <div className="relative w-16 h-16 flex items-center justify-center">
                                <span className="absolute text-sm font-bold text-white">92</span>
                            </div>
                            <div>
                                <div className="text-sm text-white font-bold">Excellent Coverage</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // AuthModal (Updated with Social Logins)
        const AuthModal = ({ isOpen, onClose, onLoginAs }) => {
            const [view, setView] = useState('FAN');
            const [email, setEmail] = useState('');
            const [pass, setPass] = useState('');
            const [error, setError] = useState('');

            if (!isOpen) return null;

            const handleLogin = (e) => {
                e.preventDefault();
                setError('');
                if (view === UserRole.STAFF) {
                    if (email === 'Mosport001' && pass === 'Mosport001') {
                        onLoginAs(UserRole.STAFF);
                    } else {
                        setError('Invalid Staff Credentials. Try Mosport001.');
                    }
                    return;
                }
                onLoginAs(view);
            };

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/90 backdrop-blur-sm" onClick={onClose} />

                    <div className="relative w-full max-w-md bg-mosport-card border border-gray-800 rounded-2xl p-8 shadow-2xl animate-fadeIn">
                        <button type="button" onClick={onClose} className="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors z-10">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6">
                                <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>

                        <div className="text-center mb-6">
                            <div className="inline-flex items-center gap-2 mb-4">
                                <span className="text-3xl font-black italic tracking-tighter text-mosport-fan">MS</span>
                                <span className="text-xl font-bold text-white">MOSPORT</span>
                            </div>
                            <h2 className="text-xl font-bold text-white mb-2">
                                {view === UserRole.FAN ? 'Welcome, Fan' : view === UserRole.VENUE ? 'Partner Login' : 'Staff Portal'}
                            </h2>
                        </div>

                        <div className="flex p-1 bg-gray-900 rounded-lg mb-6">
                            {[UserRole.FAN, UserRole.VENUE, UserRole.STAFF].map(role => (
                                <button
                                    key={role}
                                    onClick={() => { setView(role); setError(''); setEmail(''); setPass(''); }}
                                    className={`flex-1 py-2 text-xs font-bold uppercase tracking-wider rounded-md transition-all ${view === role ? 'bg-gray-800 text-white shadow' : 'text-gray-500 hover:text-gray-300'
                                        }`}
                                >
                                    {role}
                                </button>
                            ))}
                        </div>

                        <form onSubmit={handleLogin} className="space-y-4">
                            {error && <div className="text-xs text-red-500 font-bold bg-red-900/10 p-2 rounded text-center border border-red-900/30">{error}</div>}

                            <div className="space-y-2">
                                <label className="text-xs font-bold text-gray-500 uppercase">
                                    {view === UserRole.STAFF ? 'Agent ID' : 'Email Address'}
                                </label>
                                <input
                                    type="text"
                                    required
                                    value={email}
                                    onChange={e => setEmail(e.target.value)}
                                    placeholder={view === UserRole.STAFF ? 'Mosport001' : 'user@example.com'}
                                    className="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-blue-500 focus:outline-none transition-colors placeholder-gray-600"
                                />
                            </div>
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-gray-500 uppercase">Password</label>
                                <input
                                    type="password"
                                    required
                                    value={pass}
                                    onChange={e => setPass(e.target.value)}
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    className="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-blue-500 focus:outline-none transition-colors placeholder-gray-600"
                                />
                            </div>

                            <Button
                                fullWidth
                                type="submit"
                                variant={view === UserRole.VENUE ? 'secondary' : 'primary'}
                                className="py-3"
                            >
                                {view === UserRole.FAN ? "Let's go Team!" : view === UserRole.VENUE ? "Enter Dashboard" : "Authenticate"}
                            </Button>
                        </form>

                        {/* Social Login Section - Only for FAN and VENUE for now */}
                        {view !== UserRole.STAFF && (
                            <>
                                <div className="relative my-6">
                                    <div className="absolute inset-0 flex items-center">
                                        <div className="w-full border-t border-gray-800"></div>
                                    </div>
                                    <div className="relative flex justify-center text-xs">
                                        <span className="px-2 bg-mosport-card text-gray-500 font-bold uppercase">Or continue with</span>
                                    </div>
                                </div>

                                <div className="grid grid-cols-4 gap-3">
                                    <Button variant="social" className="h-10 text-xl flex items-center justify-center">G</Button>
                                    <Button variant="social" className="h-10 text-xl flex items-center justify-center">f</Button>
                                    <Button variant="social" className="h-10 text-xl flex items-center justify-center">Z</Button>
                                    <Button variant="social" className="h-10 text-xl flex items-center justify-center">IG</Button>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // ==========================================
        // APP
        // ==========================================
        function App() {
            const [currentRole, setCurrentRole] = useState(UserRole.FAN);
            const [signals, setSignals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isAuthOpen, setIsAuthOpen] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            const [locationFilter, setLocationFilter] = useState('Ha Noi');
            const [dateRange, setDateRange] = useState({ from: '', to: '' });

            useEffect(() => {
                const fetchData = async () => {
                    setLoading(true);
                    const data = await getDecisionSignals(locationFilter);
                    setSignals(data);
                    setLoading(false);
                };
                fetchData();
            }, [locationFilter]);

            const handleRoleLogin = (role) => {
                setCurrentRole(role);
                setIsAuthOpen(false);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleHomeClick = () => {
                setCurrentRole(UserRole.FAN);
                setSearchTerm('');
                setLocationFilter('Ha Noi');
                setDateRange({ from: '', to: '' });
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // Smart Search Mapping
            const getSearchKeywords = (term) => {
                const t = term.toLowerCase();
                if (t === 'soccer' || t === 'football' || t === 'bong da') return ['v.league', 'premier league', 'champions league', 'aff cup', 'vietnam', 'hanoi'];
                if (t === 'baseball') return ['mlb', 'npb'];
                if (t === 'basketball') return ['nba', 'vba'];
                if (t === 'hanoi' || t === 'ha noi') return ['hanoi', 'ha noi'];
                return [t];
            };

            const filteredBySearch = signals.filter(s => {
                // 1. Text Search
                const lowerTerm = searchTerm.toLowerCase();
                let matchesSearch = true;
                if (lowerTerm) {
                    const keywords = getSearchKeywords(lowerTerm);
                    matchesSearch = keywords.some(k =>
                        s.event.title.toLowerCase().includes(k) ||
                        s.event.league.toLowerCase().includes(k) ||
                        s.event.teamA.toLowerCase().includes(k) ||
                        s.event.teamB.toLowerCase().includes(k)
                    );
                }

                // 2. Date Range Search
                let matchesDate = true;
                if (dateRange.from || dateRange.to) {
                    const eventDate = new Date(s.event.startTime);
                    eventDate.setHours(0, 0, 0, 0); // Normalize time

                    if (dateRange.from) {
                        const fromDate = new Date(dateRange.from);
                        fromDate.setHours(0, 0, 0, 0);
                        if (eventDate < fromDate) matchesDate = false;
                    }
                    if (dateRange.to && matchesDate) {
                        const toDate = new Date(dateRange.to);
                        toDate.setHours(0, 0, 0, 0);
                        if (eventDate > toDate) matchesDate = false;
                    }
                }

                return matchesSearch && matchesDate;
            });

            const displayedSignals = currentRole === UserRole.VENUE
                ? filteredBySearch.map(s => ({
                    ...s,
                    matchedVenues: s.matchedVenues.filter(v => v.venue.id === 'v1')
                })).filter(s => s.matchedVenues.length > 0)
                : filteredBySearch;

            return (
                <div className="min-h-screen bg-mosport-black font-sans text-gray-200 pb-20 selection:bg-pink-500 selection:text-white">
                    <div className="bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 text-center py-2 px-4 border-b border-white/5 shadow-lg relative z-50">
                        <div className="flex items-center justify-center gap-2 animate-fadeIn">
                            <span className="relative flex h-2 w-2">
                                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                                <span className="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                            </span>
                            <p className="text-[10px] font-mono font-medium tracking-widest text-gray-400 uppercase">
                                SYSTEM STATUS: <span className="text-gray-200 font-bold">{APP_VERSION}</span>
                            </p>
                        </div>
                    </div>

                    <Navbar
                        currentRole={currentRole}
                        setRole={setCurrentRole}
                        onLoginClick={() => setIsAuthOpen(true)}
                        onHomeClick={handleHomeClick}
                    />

                    {currentRole === UserRole.FAN && (
                        <SearchHero
                            onSearch={setSearchTerm}
                            onLocationChange={setLocationFilter}
                            dateRange={dateRange}
                            onDateChange={setDateRange}
                        />
                    )}

                    <main className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
                        {currentRole === UserRole.VENUE && !loading && <VenueAnalytics />}

                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-xl font-bold text-white flex items-center gap-2 tracking-tight">
                                {currentRole === UserRole.VENUE ? 'Matched Events (Your Schedule)' : 'Upcoming Matches'}
                            </h2>
                            {loading && <span className="text-[10px] font-mono text-mosport-venue animate-pulse">CONNECTING TO MO-ENGINE...</span>}
                        </div>

                        {loading ? (
                            <div className="space-y-4">
                                {[1, 2].map(i => <div key={i} className="h-48 bg-gray-900/50 rounded-xl animate-pulse border border-gray-800"></div>)}
                            </div>
                        ) : (
                            <div className="space-y-6">
                                {displayedSignals.length > 0 ? displayedSignals.map(signal => (
                                    <DecisionCard key={signal.eventId} signal={signal} userRole={currentRole} />
                                )) : (
                                    <div className="text-center py-10 text-gray-500 border border-gray-800 rounded-xl border-dashed">
                                        No matched events found for {locationFilter} {searchTerm && `matching "${searchTerm}"`}.
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="mt-16 text-center border-t border-gray-800 pt-10 pb-12">
                            <h3 className="text-sm font-black text-gray-400 mb-3 tracking-[0.2em] uppercase flex items-center justify-center gap-2">
                                Mosport Ecosystem <span className="text-mosport-venue">///</span> V6.6
                            </h3>
                            <div className="mt-8 text-[9px] text-gray-700 font-mono">
                                ¬© 2024 MOSPORT INC. ALL RIGHTS RESERVED.
                            </div>
                        </div>
                    </main>

                    <AuthModal isOpen={isAuthOpen} onClose={() => setIsAuthOpen(false)} onLoginAs={handleRoleLogin} />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>